<!DOCTYPE html>

<head th:insert="librerias::librerias">
</head>

<body>

	<div th:insert="top"></div>
	
	<div class="container">
		<header>
			
		</header>
		<div class="row pl-5 pr-5">
			<div class="col-9">
				<h5> Ficha de alumno </h5>
				<div class="card border border primary" th:object="${alumnoMostrar}">
					<div class="card-body row pt-4 pb-4">
						<div class="col-7">
							<div class="card">
								<div class="card-header text-dark bg-light">Ficha del alumno

								</div>
								<div class="card-body">
									<div id="respuestaAjax">

										</div>

										<form id="formAjax" th:action="@{/alumnos/edit/{id}(id=${alumnoMostrar.id})}" method="POST">

											<input th:field=*{nombre} name="nombre" id="nombreAjax" type="text" class="form-control"
												th:attr="placeholder=${alumnoMostrar.nombre}">

											<p><a th:href="@{/alumnos}" class="btn btn-danger mt-3">Cerrar</a></p>
											<p><a th:href="@{/alumnosRest/{id}(id=${alumnoMostrar.id})}" class="btn btn-warning mt-3">Consulta JSON</a></p>
											
											<input type="submit" value="Edit normal" class="btn btn-primary float-right">
											<button id="editAjax" type="submit" class="btn btn-success">Guardar Ajax</button>
											


										</form>
									<p><a th:href="@{/alumnos}" class="btn btn-primary mt-3">Cerrar</a></p>
								</div>
							</div>
						</div>
						<div class="col-5">
							<div class="card">
								<div class="card-header text-dark bg-light">Datos del alumno
								</div>
								<div class="card-body">
									<span>
										<span>ID: <p id="idAjax" th:text="${alumnoMostrar.id}" class="card-text mb-2 card-text"></p></span>
									</span>								
								
									<span>
										<span>Nombre:<p th:text="${alumnoMostrar.nombre}" class="card-text mb-2 card-text"></p></span>
									</span>
									<span>
										<span>Apellidos:<p th:text="${alumnoMostrar.Apellidos}" class="card-text mb-2 card-text"></p></span>
									</span>
									<span>
										<span>DNI:<p th:text="${alumnoMostrar.dni}" class="card-text mb-2 card-text"></p></span>
									</span>
									<span>
										<span>Profesor:<p th:text="${alumnoMostrar.profesor.nombre}+' '+${alumnoMostrar.profesor.apellidos}" class="card-text mb-2 card-text"></p></span>
									</span>
									<span>
										<span>Coche:<p th:text="${alumnoMostrar.coche.marca}+' '+${alumnoMostrar.coche.modelo}" class="card-text mb-2 card-text"></p></span>
									</span>
								</div>
							</div>
						</div>
						
						<div class="col-5">
							<div class="card">
								<div class="card-header text-dark bg-light">Notas
								</div>
								<div class="card-body">
									<span>
										<span><p th:text="${alumnoMostrar.notas}" class="card-text mb-2 card-text"></p></span>
									</span>
								
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script>
		
		$(document).ready(function(){
			$("#editAjax").click(function(event){
				console.log("Hola");
			
				
				event.preventDefault();
				
				fire_ajax_submit();
				
			})
		})
		
		function fire_ajax_submit(){
			
			//crear json con alumno a EDITAR
			var alumnoDTO={};
			alumnoDTO["nombre"]= $("#nombreAjax").val();
			alumnoDTO["id"]=$("#idAjax").text();
			
			console.log(alumnoDTO);
			$("#editAjax").prop("disable",true);

			console.log(JSON.stringify(alumnoDTO));
			
			//construir peticion asincrona
			$.ajax({
				
				type: "POST",
				contentType: "application/json",
				url: "/alumnos/guardarAjax",
				data: JSON.stringify(alumnoDTO),
				datatype: "json",
				cache: false,
				timeout:  100000,
				success: function(data){
					
					var json="<h5>Respuesta Ajax</h5></br>"+
					
					JSON.stringify(data,null,4);
					
					$("#respuestaAjax").html(json);
				},
				error: function(e){
					console.log("ERROR",e);
				}
			})
			
		}
		
	
	</script>
</body>
</html>