<!DOCTYPE html>
<html lang="en">

<head th:insert="librerias::librerias">

</head>

<body class="container-fluid theme theme-letter">

	<div th:insert="top"></div>
	<div class="container">

		<h1>Registro de Coches</h1>

		<div th:if="${listaCoches.Empty}">
			<h1>No hay Coches</h1>
		</div>

		<div class="d-flex justify-content-around flex-wrap">

			<div th:each="coche:${listaCoches}" class="card user-card h-100" style="width: 18rem;">
				<div class="image" th:if="${coche.url!=null}">
					<img th:src="@{${coche.url}}" alt="${image.name}" width="300px" height="300px"
						class="card-img-top img-fluid" />
				</div>
				<div class="card-header theme-header theme-letter d-flex align-items-center">
					<h5 class="card-title" th:text="${coche.marca}+' '+${coche.modelo}"></h5>
				</div>
				<div class="card-body theme">
					<div class="d-flex justify-content-around justify-content-md-between">
						<a th:href="@{/coches/{id}(id=${coche.id})}" class="btn btn-primary btn-sm">Ver Coche</a>
						<a sec:authorize="hasAuthority('ROLE_ADMIN')" th:attr="data-target='#modal-edit'+${coche.id}" data-toggle="modal" data-target="#modal-edit"
							class="btn btn-primary text-white pointer btn-sm">
							Modificar
						</a>
						<a sec:authorize="hasAuthority('ROLE_ADMIN')" th:attr="data-target='#modal-delete'+${coche.id}" data-toggle="modal"
							data-target="#modal-delete" class="btn btn-danger text-white pointer btn-sm">
							Eliminar
						</a>
					</div>
				</div>
			</div>

		</div>

		<div class="d-flex justify-content-sm-around">
			<div class="row mt-3">
				<div class="col-md-auto d-flex justify-content-around ">
					<button sec:authorize="hasAuthority('ROLE_ADMIN')" class="btn btn-primary mb-3" type="button"
						data-toggle="modal" data-target="#crearCoche"> Añadir
						Coche </button>

				</div>

				<div th:object="${coche}" class="col-md-auto d-flex justify-content-around">
					<button th:attr="data-target='#modal-search'" class="btn btn-primary mb-3" type="button"
						data-toggle="modal" data-target="#buscarCochePorMarca">Buscar por marca</button>
				</div>

				<div th:object="${coche}" class="col-md-auto d-flex justify-content-around">
					<button th:attr="data-target='#modal-search-matricula'" class="btn btn-primary mb-3" type="button"
						data-toggle="modal" data-target="#buscarCochePorMatricula">Buscar por Matrícula</button>
				</div>
			</div>
		</div>
			<div id="error-message" class="alert alert-danger w-50 m-auto text-center p-5 mt-3" th:if="${error}">
				[[${error}]]
			</div>

		<!-- buscar por marca modal-->
		<div class="modal fade" th:id="modal-search">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header theme-header">
						<h4 class="modal-title" id="exampleModalLabel">Buscar Coche</h4>
						<button class="close btn btn-danger" type="button" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">x</span>
						</button>
					</div>
					<div class="modal-body theme">
						<p class="error-text">Introduce la marca para buscar</p>


						<!--formulario marca-->
						<form action="#" th:action="@{/coches/searchMarca/}" th:object="${cocheaBuscar}" method="post">
							<div class"form-row">
								<div class="form-group mt-1">
									<label for="texto">Marca</label>
									<input type="text" th:field="*{marca}" class="form-control campo-form" id="exampleInputName"
										placeholder="Marca" />
								</div>
							</div>

							<div class="modal-footer theme-header">
								<button class="btn btn-secondary btn-sm" data-dismiss="modal"
									aria-hidden="true">Cancelar</button>
								<input id="sent" type="submit" th:value="Buscar" class="btn btn-primary float-right" />
							</div>
						</form>
					</div>
				</div>
			</div>

		</div>
		<!-- fin modal buscar por marca-->

		<!-- buscar por matricula modal-->
		<div class="modal fade" th:id="modal-search-matricula">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header theme-header">
						<h4 class="modal-title" id="exampleModalLabel">Buscar Coche</h4>
						<button class="close btn btn-danger" type="button" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">x</span>
						</button>
					</div>
					<div class="modal-body theme">
						<p class="error-text">Introduce la matrícula para buscar</p>


						<!--formulario matricula-->
						<form action="#" th:action="@{/coches/searchMatricula}" th:object="${cocheaBuscar}"
							method="post" class="needs-validation" novalidate>
							<div class"form-row">
								<div class="form-group mt-1">
									<label for="texto">Matrícula</label>
									<input type="text" th:field="*{matricula}" class="form-control campo-form"
										pattern="[0-9]{4}\s[a-zA-Z]{3}" required id="exampleInputName"
										placeholder="Matrícula" />
									<div class="alert alert-danger invalid-feedback">
										Por favor, ingresa 4 números y 3 letras separados por un espacio
									</div>
								</div>
							</div>

							<div class="modal-footer theme-header">
								<button class="btn btn-secondary btn-sm" data-dismiss="modal"
									aria-hidden="true">Cancelar</button>
								<input id="sent" type="submit" th:value="Buscar" class="btn btn-primary float-right" />
							</div>
						</form>
					</div>
				</div>
			</div>

		</div>
		<!-- fin modal buscar por matricula-->

		<!--create modal-->

		<div class="modal fade" id="crearCoche">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header theme-header">
						<h4 class="modal-title" id="exampleModalLabel">Crear coche/a</h4>
						<button class="close btn btn-danger" type="button" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">x</span>
						</button>
					</div>
					<div class="modal-body theme">
						<p class="error-text">Introduce el nombre para el nuevo coche
							<!--formulario nombre a editar-->
						<form action="#" th:action="@{/coches/add/}" th:object="${cocheNuevo}" method="post"
							class="needs-validation" novalidate>
							<div class"form-row">
								<div class="form-group mt-1">
									<label for="Marca">Marca</label>
									<input type="text" th:field="*{marca}" class="form-control campo-form" id="marca"
										placeholder="Marca" required />
									<div class="form-group mt-1">
										<label for="matricula">Matrícula</label>
										<input type="text" th:field="*{matricula}" class="form-control campo-form"
											pattern="[0-9]{4}\s[a-zA-Z]{3}" required id="matricula"
											placeholder="Matrícula" />
										<div class="invalid-feedback">
											Por favor, ingresa 4 números y 3 letras separados por un espacio
										</div>
									</div>
									<label for="modelo">Modelo</label>
									<input type="text" th:field="*{modelo}" class="form-control campo-form" id="modelo"
										placeholder="Modelo" required />
									<label for="fecha">Fecha ITV</label>
									<input type="date" name="fechaITV" th:field="*{fechaITV}" class="form-control campo-form theme-letter"
										id="fecha" placeholder="fechaITV" required />

								</div>
							</div>
					</div>
					<div class="modal-footer theme-header">
						<button class="btn btn-secondary btn-sm" data-dismiss="modal"
							aria-hidden="true">Cancelar</button>
						<input type="submit" value="Crear" class="btn btn-primary float-right" />
					</div>
					</form>
				</div>
			</div>
		</div>
		<!-- fin create modal-->

		<!--delete modal-->
		<div th:each="coche:${listaCoches}">
			<div class="modal fade" th:id="modal-delete+${coche.id}">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header theme-header">
							<h4 class="modal-title" id="exampleModalLabel">Borrar</h4>
							<button class="close btn btn-danger" type="button" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">x</span>
							</button>
						</div>
						<div class="modal-body theme">
							<p class="error-text">Seguro que quieres borrar este coche?
								<strong><span th:text="${coche.marca}+' '+${coche.matricula}"> </span></strong>
							</p>
						</div>
						<div class="modal-footer theme-header">
							<button class="btn btn-secondary btn-sm" data-dismiss="modal"
								aria-hidden="true">Cancelar</button>
							<form th:action="@{/coches/delete/{id}(id=${coche.id})}" th:method="GET">
								<button type="submit" name="submit" value="value"
									class="btn btn-danger btn.sm">Borrar</button>
							</form>

						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- fin delete modal-->

		<!-- edit modal-->
		<div th:each="coche:${listaCoches}">
			<div class="modal fade" th:id="modal-edit+${coche.id}">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header theme-header">
							<h4 class="modal-title" id="exampleModalLabel">Modificar</h4>
							<button class="close btn btn-danger" type="button" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">x</span>
							</button>
						</div>
						<div class="modal-body theme">
							<p class="error-text">Introduce matricula nueva para el coche:
								<strong><span th:text="${coche.matricula}"> </span></strong>
							</p>
							<!--formulario nombre a editar-->
							<form action="#" th:action="@{/coches/edit/{id}(id=${coche.id})}"
								th:object="${cocheaEditar}" method="post" class="needs-validation" novalidate>
								<div class"form-row">
									<div class="form-group mt-1">
										<label for="matricula">Matrícula</label>
										<input type="text" th:field="*{matricula}" class="form-control campo-form"
											pattern="[0-9]{4}\s[a-zA-Z]{3}" id="matricula" placeholder="Matrícula" />
										<div class="invalid-feedback">
											Por favor, ingresa 4 números y 3 letras separados por un espacio
										</div>
									</div>
									<div class="form-group mt-1">
										<label for="fecha">Fecha ITV</label>
										<input type="date" name="fechaITV" th:field="*{fechaITV}" class="form-control campo-form"
											id="fecha" placeholder="fechaITV" />
									</div>
								</div>

								<div class="modal-footer theme-header">
									<button class="btn btn-secondary btn-sm" data-dismiss="modal"
										aria-hidden="true">Cancelar</button>
									<input type="submit" value="Modificar" class="btn btn-primary float-right" />
								</div>
							</form>


						</div>
					</div>
				</div>
			</div>

		</div>
		<!-- fin edit modal-->

	</div>
</body>
<script th:src="@{/static/js/validaForm.js}"></script>
<link rel="stylesheet" th:href="@{/static/css/usuarios.css}">
<script th:src="@{/static/js/cardCoche.js}"></script>

</html>
